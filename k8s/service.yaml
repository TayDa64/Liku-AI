# =============================================================================
# Liku-AI Service
# WebSocket service with sticky sessions for connection affinity
# =============================================================================
apiVersion: v1
kind: Service
metadata:
  name: liku-ai
  namespace: liku-ai
  labels:
    app.kubernetes.io/name: liku-ai
    app.kubernetes.io/component: server
spec:
  type: ClusterIP
  # Session affinity ensures WebSocket connections stay on same pod
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 3600  # 1 hour
  ports:
    - name: websocket
      port: 3847
      targetPort: 3847
      protocol: TCP
  selector:
    app.kubernetes.io/name: liku-ai
    app.kubernetes.io/component: server
---
# =============================================================================
# Liku-AI Headless Service (for StatefulSet-style discovery)
# =============================================================================
apiVersion: v1
kind: Service
metadata:
  name: liku-ai-headless
  namespace: liku-ai
  labels:
    app.kubernetes.io/name: liku-ai
    app.kubernetes.io/component: server
spec:
  type: ClusterIP
  clusterIP: None  # Headless
  ports:
    - name: websocket
      port: 3847
      targetPort: 3847
      protocol: TCP
  selector:
    app.kubernetes.io/name: liku-ai
    app.kubernetes.io/component: server
